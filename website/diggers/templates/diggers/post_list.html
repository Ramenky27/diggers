{% extends 'diggers/layouts/blog.html' %}
{% load static %}

{% block title %}
    {% if author %}
        {% if author == request.user %}Мої пости{% else %}Пости користувача {{ author.username }}{% endif %}
    {% elif category %}
        Пости категорії {{ category.name }}
    {% elif tags %}
        Пости за тегами {{ tags }}
    {% else %}
        Блоґ
    {% endif %}
{% endblock %}

{% block content %}
    {% if author %}
        {% include 'diggers/blocks/profile.html' %}
    {% elif category %}
        <h2 class="page-content__title">Пости категорії {{ category.name }}</h2>
    {% elif tags %}
        <h2 class="page-content__title">Пости за тегами {{ tags }}</h2>
    {% endif %}

    {% for post in posts %}
        <article class="entry">

            <header class="entry__header">

                <h2 class="entry__title h1">
                    <a href="{% url 'diggers:post_detail' post.pk %}" title="">{{ post.title }}</a>
                </h2>

                <div class="entry__meta">
                    <ul>
                        <li>{{ post.created_date }}</li>
                        <li>
                            <a href="{% url 'diggers:list_by_category' category=post.category.route %}" title=""
                               rel="category tag">{{ post.category.name }}</a>
                        </li>
                        <li><a href="{% url 'diggers:list_by_author' post.author %}">{{ post.author }}</a></li>
                        <li>6 Коментарів</li>
                                             {% if request.user.is_authenticated and post.author == request.user or perms.diggers.moderate_post %}
                            {% if perms.diggers.change_post %}
                                <li><a href="{% url "diggers:post_update" post.pk %}" title="">Редагувати</a></li>
                            {% endif %}

                            {% if perms.diggers.delete_cmspost %}
                                <li><a href="{% url "diggers:post_delete" post.pk %}" title="">Видалити</a></li>
                            {% endif %}
                        {% endif %}
                    </ul>
                </div>

            </header>

            <div class="entry__content">
                {{ post.text|truncatechars:400|linebreaks }}
                {% if post.text|length > 400 %}
                    <a href="{% url 'diggers:post_detail' post.pk %}">Читати далі...</a>
                {% endif %}
            </div>
        </article> <!-- end entry -->
    {% endfor %}

    {% if posts.has_other_pages %}
        <!-- page nav -->
        <div class="post-list-nav">
            <nav class="pgn">
                <ul>
                    {% if posts.has_previous %}
                        <li>
                            <a rel="prev" class="pgn__prev" href="?page={{ posts.previous_page_number }}">Попередня</a>
                        </li>
                    {% endif %}

                    {% for i in posts.paginator.page_range %}
                        <li>
                            {% if posts.number == i %}
                                <span class="pgn__num current">{{ i }}</span>
                            {% else %}
                                <a rel="page{{ i }}" class="pgn__num" href="?page={{ i }}">{{ i }}</a>
                            {% endif %}
                        </li>
                    {% endfor %}

                    {% if posts.has_next %}
                        <li>
                            <a rel="next" class="pgn__next" href="?page={{ posts.next_page_number }}">Наступна</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    {% endif %}
{% endblock %}
